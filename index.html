<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agenda Carnet - Réservations</title>
  <style>
    :root {
      --violet: #5e35b1;
      --violet-clair: #7e57c2;
      --orange: #ff9800;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
    }

    header {
      background: var(--violet);
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 1.4rem;
    }

    .container {
      max-width: 1100px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    h2 {
      color: var(--violet);
      margin-top: 0;
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 20px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 4px;
    }

    input, select, textarea {
      width: 100%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    .actions {
      grid-column: 1 / -1;
      text-align: right;
      margin-top: 10px;
    }

    button {
      background: var(--violet);
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: var(--violet-clair);
    }

    .switch-pro-part {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .switch-pro-part button {
      flex: 1;
      background: #ddd;
      color: var(--violet);
      font-weight: bold;
    }

    .switch-pro-part button.active {
      background: var(--violet);
      color: white;
    }

    .voyant {
      width: 12px;
      height: 12px;
      display: inline-block;
      border-radius: 50%;
      margin-left: 5px;
      background: #ccc;
      vertical-align: middle;
    }

    .voyant.orange { background: var(--orange); }
    .voyant.mauve { background: var(--violet); }

    .reservation-jour {
      margin-top: 30px;
    }

    .reservation-item {
      background: #f9f9f9;
      padding: 8px 10px;
      border-radius: 4px;
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .reservation-item strong {
      color: var(--violet);
    }

    @media screen and (max-width: 600px) {
      form {
        grid-template-columns: 1fr;
      }
      .actions {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <header>📅 Agenda Carnet - Réservations</header>

  <div class="container">
    <h2>Nouvelle réservation</h2>

    <div class="switch-pro-part">
      <button id="btn-pro">PRO</button>
      <button id="btn-part">PART</button>
    </div>

    <form id="reservation-form">
      <div>
        <label for="nom">Nom</label>
        <input type="text" id="nom" name="nom" required>
      </div>
      <div>
        <label for="prenom">Prénom</label>
        <input type="text" id="prenom" name="prenom" required>
      </div>
      <div>
        <label for="date">Date</label>
        <input type="date" id="date" name="date" required>
      </div>
      <div>
        <label for="heure">Heure</label>
        <input type="time" id="heure" name="heure" required>
      </div>
      <div>
        <label for="facture">Facture</label>
        <select id="facture" name="facture">
          <option value="">-- Sélectionner --</option>
          <option value="pro">Professionnel</option>
          <option value="part">Particulier</option>
        </select>
        <span class="voyant" id="voyant-facture"></span>
      </div>
      <div>
        <label for="note">Note</label>
        <select id="note" name="note">
          <option value="">-- Sélectionner --</option>
          <option value="remarque">Remarque</option>
          <option value="info">Info</option>
        </select>
        <span class="voyant" id="voyant-note"></span>
      </div>
      <div class="actions">
        <button type="submit">Ajouter</button>
      </div>
    </form>

    <div class="reservation-jour">
      <h2>Réservations du jour</h2>
      <div id="liste-reservations"></div>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAiRQYtjjPjkwiU76iqZGdnxgxjjbbaLQI",
      authDomain: "agendacarnet.firebaseapp.com",
      projectId: "agendacarnet",
      storageBucket: "agendacarnet.firebasestorage.app",
      messagingSenderId: "593717794727",
      appId: "1:593717794727:web:e45a8b06f4e9d356b74882"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById('reservation-form');
    const liste = document.getElementById('liste-reservations');
    const factureSelect = document.getElementById('facture');
    const noteSelect = document.getElementById('note');
    const voyantFacture = document.getElementById('voyant-facture');
    const voyantNote = document.getElementById('voyant-note');

    // Voyants interactifs
    factureSelect.addEventListener('change', () => {
      voyantFacture.className = 'voyant ' + (factureSelect.value ? 'orange' : '');
    });

    noteSelect.addEventListener('change', () => {
      voyantNote.className = 'voyant ' + (noteSelect.value ? 'orange' : '');
    });

    // Boutons PRO / PART
    const btnPro = document.getElementById('btn-pro');
    const btnPart = document.getElementById('btn-part');
    let typeClient = '';

    function updateButtons(selected) {
      if (selected === 'pro') {
        btnPro.classList.add('active');
        btnPart.classList.remove('active');
        typeClient = 'pro';
      } else if (selected === 'part') {
        btnPart.classList.add('active');
        btnPro.classList.remove('active');
        typeClient = 'part';
      } else {
        btnPro.classList.remove('active');
        btnPart.classList.remove('active');
        typeClient = '';
      }
    }

    btnPro.addEventListener('click', () => updateButtons('pro'));
    btnPart.addEventListener('click', () => updateButtons('part'));

    // Charger les réservations
    async function refreshList() {
      liste.innerHTML = '';
      const querySnapshot = await getDocs(collection(db, "reservations"));
      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement('div');
        div.className = 'reservation-item';
        div.innerHTML = `<strong>${data.prenom || ''} ${data.nom || ''}</strong> – ${data.date || ''} ${data.heure || ''}`;
        const delBtn = document.createElement('button');
        delBtn.textContent = '🗑️';
        delBtn.addEventListener('click', async () => {
          await deleteDoc(doc(db, "reservations", docSnap.id));
          refreshList();
        });
        div.appendChild(delBtn);
        liste.appendChild(div);
      });
    }

    // Ajouter une réservation
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const newReservation = {
        nom: form.nom.value,
        prenom: form.prenom.value,
        date: form.date.value,
        heure: form.heure.value,
        facture: factureSelect.value,
        note: noteSelect.value,
        clientType: typeClient
      };
      await addDoc(collection(db, "reservations"), newReservation);
      form.reset();
      voyantFacture.className = 'voyant';
      voyantNote.className = 'voyant';
      updateButtons('');
      refreshList();
    });

    // Initialisation
    refreshList();
  </script>
  <script type="module">
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";

    const firebaseConfigRealtime = {
      apiKey: "AIzaSyAiRQYtjjPjkwiU76iqZGdnxgxjjbbaLQI",
      authDomain: "agendacarnet.firebaseapp.com",
      projectId: "agendacarnet",
      storageBucket: "agendacarnet.firebasestorage.app",
      messagingSenderId: "593717794727",
      appId: "1:593717794727:web:e45a8b06f4e9d356b74882"
    };

    const appRealtime = initializeApp(firebaseConfigRealtime, "realtime");
    const dbRealtime = getFirestore(appRealtime);
    const reservationsCol = collection(dbRealtime, "reservations");

    // Conteneur notifications
    let notifContainer = document.getElementById("notif-container");
    if (!notifContainer) {
      notifContainer = document.createElement("div");
      notifContainer.id = "notif-container";
      notifContainer.style.position = "fixed";
      notifContainer.style.top = "10px";
      notifContainer.style.left = "50%";
      notifContainer.style.transform = "translateX(-50%)";
      notifContainer.style.zIndex = "10000";
      notifContainer.style.display = "flex";
      notifContainer.style.flexDirection = "column";
      notifContainer.style.gap = "10px";
      notifContainer.style.width = "90%";
      notifContainer.style.maxWidth = "400px";
      notifContainer.style.pointerEvents = "none";
      document.body.appendChild(notifContainer);
    }

    function showPersistentNotification(message) {
      const toast = document.createElement("div");
      toast.style.background = "#5e35b1";
      toast.style.color = "white";
      toast.style.padding = "10px 15px";
      toast.style.borderRadius = "8px";
      toast.style.boxShadow = "0 2px 6px rgba(0,0,0,0.3)";
      toast.style.fontSize = "14px";
      toast.style.display = "flex";
      toast.style.justifyContent = "space-between";
      toast.style.alignItems = "center";
      toast.style.gap = "10px";
      toast.style.pointerEvents = "auto";
      toast.style.wordWrap = "break-word";

      const text = document.createElement("div");
      text.textContent = message;
      text.style.flex = "1";

      const closeBtn = document.createElement("button");
      closeBtn.textContent = "✖";
      closeBtn.style.background = "transparent";
      closeBtn.style.border = "none";
      closeBtn.style.color = "white";
      closeBtn.style.cursor = "pointer";
      closeBtn.style.fontSize = "16px";
      closeBtn.addEventListener("click", () => toast.remove());

      toast.appendChild(text);
      toast.appendChild(closeBtn);
      notifContainer.appendChild(toast);
    }

    // Listener temps réel Firestore
    onSnapshot(reservationsCol, (snapshot) => {
      snapshot.docChanges().forEach(change => {
        const data = change.doc.data();
        const date = data.date || "Date ?";
        const prenom = data.prenom || "";
        const nom = data.nom || "";
        const nomComplet = (prenom + " " + nom).trim() || "Client inconnu";

        if (change.type === "added") {
          showPersistentNotification(`🟢 Nouvelle réservation : ${nomComplet} – ${date}`);
        }
        if (change.type === "modified") {
          showPersistentNotification(`🟡 Réservation modifiée : ${nomComplet} – ${date}`);
        }
        if (change.type === "removed") {
          showPersistentNotification(`🔴 Réservation supprimée : ${nomComplet} – ${date}`);
        }

        // 🔄 Mise à jour automatique de la liste existante
        if (typeof refreshList === "function") {
          refreshList();
        }
      });
    });
  </script>
</body>
</html>






